
from sklearn import tree
from scikitClassifier import ScikitClassifier

import graphviz
import os
import re


class DecisionTreeClassifier(ScikitClassifier):

    def __init__(self):
        ScikitClassifier.__init__(self, tree.DecisionTreeClassifier())

    def export_tree_as_pdf(self, feature_names, label_names):
        dot_data = tree.export_graphviz(self.classifier, out_file=None,
                                        feature_names=feature_names,
                                       class_names=label_names,
                                       filled=True, rounded=True,
                                        special_characters=True)

        graph = graphviz.Source(dot_data)

        count = 0
        files = os.listdir(self.dir_for_saving_images)
        for file in files:
            new_name = re.match(r'Decision_Tree\d', file)
            if new_name:
                count += 1
        real_count = count / 2
        real_count += 1

        graph.render(filename=f"Decision_Tree{int(real_count)}", directory=self.dir_for_saving_images)
