
from sklearn import tree
from sklearn.metrics import confusion_matrix
import graphviz
import time


class DecisionTreeClassifier:

    def __init__(self):
        self.classifier = tree.DecisionTreeClassifier()
        self.tree_model = None
        self.accuracy = 0
        self.predicted_labels = []

    def train_model(self, training_data, training_labels):
        self.tree_model = self.classifier.fit(training_data, training_labels)

    def predict(self, testing_data):
        self.predicted_labels = self.classifier.predict(testing_data)

    def calculate_accuracy(self, testing_data, testing_labels):
        self.accuracy = self.classifier.score(testing_data, testing_labels)

    def export_tree_as_pdf(self, feature_names, label_names):
        dot_data = tree.export_graphviz(self.classifier, out_file=None,
                                        feature_names=feature_names,
                                        class_names=label_names,
                                        filled=True, rounded=True,
                                        special_characters=True)

        graph = graphviz.Source(dot_data)
        graph.render(filename="treeTest", directory="/home/marcus/PycharmProjects/Final_Project/")

    def benchmark_tree_classifier(self, training_data, testing_data, training_labels, testing_labels):

        start_time = time.time()
        self.train_model(training_data, training_labels)
        train_time = time.time() - start_time

        start_time = time.time()
        self.predict(testing_data)
        predict_time = time.time() - start_time

        start_time = time.time()
        self.calculate_accuracy(testing_data, testing_labels)
        accuracy_time = time.time() - start_time

        return train_time, predict_time, accuracy_time

    def print_confusion_matrix(self, testing_labels):
        conf_matrix = confusion_matrix(testing_labels, self.predicted_labels)
        print(f"Confusion Matrix\n        Benign | Malware\nBenign  {conf_matrix[0][0]}    | {conf_matrix[0][1]}\n"
              f"Malware {conf_matrix[1][0]}      | {conf_matrix[1][1]}")
