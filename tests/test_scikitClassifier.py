
import pytest
from scikitClassifier import ScikitClassifier
from sklearn import tree
from dataset import Dataset

DATASET = None

CLF = None


@pytest.fixture(autouse=True)
def clean_up():
    global CLF, DATASET
    CLF = ScikitClassifier(tree.DecisionTreeClassifier())
    DATASET = Dataset()


def test_create_confusion_matrix():
    DATASET.load_data(0.4)
    train_d, test_d, train_l, test_l = DATASET.partition_data(0.2)
    CLF.fit(train_d, train_l)
    CLF.predict(test_d)
    CLF.create_confusion_matrix(test_l)

    # The matrices are numpy arrays
    if not (CLF.normalized_confusion_matrix.dtype.name == 'float64' and
            CLF.unnormalized_confusion_matrix.dtype.name == 'int64'):
        pytest.fail(f"Confusion matrix is wrong!")
