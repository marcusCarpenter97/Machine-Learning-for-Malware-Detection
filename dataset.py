import os
import re
from mistReport import MistReport


class Dataset:

    def __init__(self):
        self.reports = []
        self.data_set_directory = "/home/marcus/PycharmProjects/Final_Project/MIST reports"

    def load_mist_data_set(self):

        mist_codes = []

        for file_name in os.listdir(self.data_set_directory):

            # Get file type from file name to label report
            file_type = re.match(r'malware|benign', file_name)
            if file_type:
                file_type = file_type.group()

            file_path = os.path.join(self.data_set_directory, file_name)

            try:
                with open(file_path, 'rb') as report:

                    for line in report:
                        # Match line with regular expression. Must convert line from bytes to string
                        new_mist_code = re.match(r'\w\w \w\w', line.decode("utf-8"))

                        # If regex finds a match then create new report
                        if new_mist_code:
                            new_mist_code = new_mist_code.group()
                            mist_codes.append(new_mist_code)

                    self.reports.append(MistReport(mist_codes, file_type))

            except IOError:
                print("IOError")
