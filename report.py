
import os
import numpy as np

REPORT_DIR = "Reports"

REPORT_HEADER = "Classifier Name, Dataset Name, Malware Rate Train, Malware Rate Test, Accuracy," \
                "Normalized true positive, Normalized true negative, Normalized false negative," \
                "Normalized false positive, Unnormalized true positive, Unnormalized true negative," \
                "Unnormalized false negative, Unnormalized false positive\n"

NEW_REPORT = ""

CURR_REPORT_DIR = ""


def build_report(classifier_name, dataset_name, malware_rate_train, malware_rate_test, accuracy,
                 conf_matrix_norm, conf_matrix_unnorm):

    temp_rep = list()

    temp_rep.append(classifier_name)
    temp_rep.append(dataset_name)
    temp_rep.append(malware_rate_train)
    temp_rep.append(malware_rate_test)
    temp_rep.append(accuracy)

    for i in np.nditer(conf_matrix_norm):
        temp_rep.append(float(i))

    for i in np.nditer(conf_matrix_unnorm):
        temp_rep.append(int(i))

    global NEW_REPORT
    for i in temp_rep:
        NEW_REPORT += str(i)
        NEW_REPORT += ','

    NEW_REPORT = NEW_REPORT[:-1]
    NEW_REPORT += "\n"


def create_new_report_directory():

    if not os.path.isdir(REPORT_DIR):
        os.mkdir(REPORT_DIR)

    existing_reports = os.listdir(REPORT_DIR)

    curr_report_num = len(existing_reports) + 1

    new_report_dir = os.path.join(REPORT_DIR, str(curr_report_num))

    os.mkdir(new_report_dir)

    global CURR_REPORT_DIR
    CURR_REPORT_DIR = new_report_dir


def save_report():

    with open(os.path.join(CURR_REPORT_DIR, 'report.csv'), 'w') as new_report:
        new_report.write(REPORT_HEADER)
        new_report.write(NEW_REPORT)
